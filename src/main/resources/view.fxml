<?xml version="1.0" encoding="UTF-8"?>

<?import java.lang.String?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.CheckBox?>
<?import javafx.scene.control.ComboBox?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ListView?>
<?import javafx.scene.control.ProgressBar?>
<?import javafx.scene.control.RadioButton?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.control.Separator?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.control.ToggleGroup?>
<?import javafx.scene.control.Tooltip?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.ColumnConstraints?>
<?import javafx.scene.layout.GridPane?>
<?import javafx.scene.layout.FlowPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.RowConstraints?>
<?import javafx.scene.layout.StackPane?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.shape.Circle?>
<?import javafx.scene.text.Font?>

<StackPane fx:id="rootPane" prefHeight="800.0" prefWidth="800.0" styleClass="root-pane" xmlns="http://javafx.com/javafx/17" xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.bacplus.MainController">
    <children>
        <!-- HOME SCREEN -->
        <VBox fx:id="homePane" alignment="TOP_CENTER" spacing="40.0" styleClass="view-pane">
            <padding>
                <Insets top="20" right="20" bottom="20" left="20" />
            </padding>
            <HBox alignment="CENTER_RIGHT">
                <HBox styleClass="points-badge">
                    <Label styleClass="star-icon" text="‚≠ê" />
                    <Label fx:id="pointsLabel" styleClass="points-value" text="0" />
                </HBox>
            </HBox>
            <VBox alignment="CENTER" spacing="40.0" VBox.vgrow="ALWAYS">
                <!-- Styled B+ Logo Box (SQUARED) -->
                <VBox alignment="CENTER" spacing="15">
                    <StackPane>
                        <VBox alignment="CENTER" style="-fx-background-color: #6c63ff; -fx-background-radius: 20; -fx-padding: 0; -fx-min-width: 100; -fx-min-height: 100; -fx-max-width: 100; -fx-max-height: 100;">
                            <Label fx:id="lblAppTitleLogo" text="B+" style="-fx-font-size: 48px; -fx-font-weight: bold; -fx-text-fill: white;"/>
                        </VBox>
                    </StackPane>
                    <Label fx:id="lblAppTitle" styleClass="title-large" text="%app.title" />
                    <Label fx:id="lblAppSubtitle" styleClass="subtitle" text="%app.subtitle" />
                </VBox>
                <Button fx:id="btnPlay" onAction="#showSetup" styleClass="btn-primary-large" text="%btn.play" />
                <HBox alignment="CENTER" spacing="20.0">
                    <Button fx:id="btnCats" onAction="#showCategories" styleClass="btn-secondary" text="%btn.categories" />
                    <Button fx:id="btnScores" onAction="#showHistory" styleClass="btn-secondary" text="%btn.scores" />
                </HBox>
                <Button fx:id="btnConfig" onAction="#showSettings" styleClass="btn-text" text="%btn.config" />
            </VBox>
        </VBox>

        <!-- SETUP SCREEN -->
        <VBox fx:id="setupPane" alignment="TOP_CENTER" spacing="30.0" styleClass="view-pane" visible="false">
            <padding><Insets top="40" right="40" bottom="60" left="40" /></padding>
            
            <Label fx:id="lblSetupTitle" styleClass="title-medium" text="Configuration de la Partie" />
            
            <HBox spacing="30.0" VBox.vgrow="ALWAYS" alignment="TOP_CENTER">
                <!-- Left Column: Settings Cards -->
                <VBox spacing="20.0" prefWidth="400.0">
                    <VBox styleClass="modern-card" spacing="15.0">
                        <Label fx:id="lblGameMode" styleClass="label-bold" text="Mode de jeu" />
                        <HBox spacing="15.0">
                            <RadioButton fx:id="radioSolo" selected="true" text="Solo" styleClass="radio-button-modern">
                                <toggleGroup><ToggleGroup fx:id="modeGroup" /></toggleGroup>
                            </RadioButton>
                            <RadioButton fx:id="radioMulti" text="Multijoueur" toggleGroup="$modeGroup" styleClass="radio-button-modern" />
                        </HBox>
                        
                        <VBox fx:id="multiplayerConfigBox" spacing="10" visible="false" managed="false" styleClass="vbox-subtle">
                            <Label text="IP Serveur:" styleClass="label-small" />
                            <TextField fx:id="serverIpField" text="127.0.0.1" promptText="Enter IP..." styleClass="modern-input-small" />
                            <HBox spacing="10">
                                 <Button fx:id="btnHost" text="H√©berger" onAction="#hostGame" styleClass="btn-secondary-small"/>
                                 <Button fx:id="btnJoin" text="Rejoindre" onAction="#joinGame" styleClass="btn-secondary-small"/>
                            </HBox>
                            <Label fx:id="connectionStatusLabel" text="" styleClass="label-bold"/>
                        </VBox>
                    </VBox>
                    
                    <VBox styleClass="modern-card" spacing="15.0">
                        <CheckBox fx:id="cbEnableTimer" selected="true" text="Activer le chrono" styleClass="modern-checkbox" />
                    </VBox>

                    <Region VBox.vgrow="ALWAYS" />
                    
                    <Button fx:id="btnBackSetup" onAction="#showHome" styleClass="btn-secondary-large" text="%btn.back" prefWidth="400.0" />
                </VBox>


                <!-- Right Column: Category Selection -->
                <VBox spacing="15.0" HBox.hgrow="ALWAYS" styleClass="modern-card">
                    <Label fx:id="lblSelectCats" text="Cat√©gories de jeu" styleClass="label-bold" />
                    <Label fx:id="lblMinCats" text="(Minimum 3 s√©lectionn√©es)" styleClass="label-hint-small" />
                    
                    <ScrollPane fitToWidth="true" styleClass="modern-scroll" VBox.vgrow="ALWAYS">
                        <VBox fx:id="categoriesSelectionBox" spacing="8.0" styleClass="category-selection-container" />
                    </ScrollPane>

                    <Button fx:id="btnStart" onAction="#startGame" styleClass="btn-primary-large" text="COMMENCER LA PARTIE" maxWidth="Infinity" />
                </VBox>
            </HBox>
        </VBox>

        <!-- GAME SCREEN -->
        <BorderPane fx:id="gamePane" styleClass="view-pane" visible="false">
            <top>
                <HBox alignment="CENTER_LEFT" spacing="20.0" styleClass="header">
                    <Button fx:id="btnQuit" onAction="#quitGame" text="‚Üê" styleClass="btn-secondary"/>
                    <StackPane>
                        <Circle fill="#6c63ff" radius="30.0" />
                        <Label fx:id="gameLetterLabel" text="M" styleClass="label-bold" style="-fx-text-fill: white;">
                     <font>
                        <Font name="System Bold" size="36.0" />
                     </font></Label>
                    </StackPane>
                    <StackPane alignment="CENTER_RIGHT" HBox.hgrow="ALWAYS">
                         <HBox spacing="20" alignment="CENTER_RIGHT">
                             <HBox styleClass="points-badge">
                                 <Label styleClass="star-icon" text="‚≠ê" />
                                 <Label fx:id="playerPointsLabel" styleClass="points-value" text="0" />
                             </HBox>
                             <Label fx:id="timerLabel" text="02:00" styleClass="timer-label" style="-fx-font-family: 'Courier New'; -fx-font-weight: bold; -fx-font-size: 18px;" />
                             <Label fx:id="scoreLabel" text="Score: 0" styleClass="label-bold"/>
                         </HBox>
                    </StackPane>
                </HBox>
            </top>
            <center>
                <ScrollPane fitToWidth="true" styleClass="scroll-pane-transparent">
                    <content>
                        <GridPane fx:id="gameGrid" hgap="20.0" vgap="20.0">
                            <columnConstraints>
                                <ColumnConstraints percentWidth="50.0" />
                                <ColumnConstraints percentWidth="50.0" />
                            </columnConstraints>
                        </GridPane>
                    </content>
               <padding>
                  <Insets bottom="20.0" left="50.0" right="50.0" top="20.0" />
               </padding>
                </ScrollPane>
            </center>
            <bottom>
                <HBox alignment="CENTER" spacing="20.0" styleClass="footer">
                    <Button fx:id="btnHint" onAction="#useHint" styleClass="btn-hint" text="üí° AIDE" />
                    <ProgressBar fx:id="progressBar" prefWidth="400.0" progress="0.0" />
                    <Button fx:id="btnEnd" onAction="#finishGame" styleClass="btn-primary" text="%btn.end" />
                </HBox>
            </bottom>
        </BorderPane>

        <!-- RESULTS SCREEN (New Detailed Layout) -->
        <VBox fx:id="resultsPane" alignment="TOP_CENTER" spacing="20.0" styleClass="view-pane" visible="false">
            <padding>
                <Insets bottom="30" left="30" right="30" top="30" />
            </padding>

            <!-- Header -->
            <HBox alignment="CENTER" spacing="15">
                <Label style="-fx-font-size: 24px;">üèÅ</Label>
                <VBox alignment="CENTER_LEFT">
                    <Label style="-fx-font-size: 24px; -fx-font-weight: bold;" text="R√âSULTATS" />
                    <Label fx:id="finalLetterLabel" styleClass="label-muted" text="Lettre de la partie : M" />
                    <Label fx:id="finalScoreLabel" styleClass="label-bold" text="0 pts" />
                </VBox>
            </HBox>

            <Separator />

            <!-- Modern Dynamic Ranking -->
            <VBox spacing="10" styleClass="result-card">
                <Label styleClass="label-bold" text="CLASSEMENT FINAL" />
                <VBox fx:id="rankingContainer" spacing="10" />
            </VBox>

            <!-- Detailed Performance -->
            <VBox spacing="10" styleClass="result-card">
                <Label styleClass="label-bold" text="VOTRE PERFORMANCE" />
                <ScrollPane fitToWidth="true" style="-fx-background-color: transparent;">
                    <content>
                        <VBox fx:id="resultsListBox" spacing="5" />
                    </content>
                </ScrollPane>
            </VBox>

            <!-- Actions -->
            <HBox alignment="CENTER" spacing="20">
                <Button onAction="#shareResults" styleClass="btn-secondary" text="üì§ PARTAGER" />
                <Button onAction="#startGame" styleClass="btn-primary" text="üîÑ Rejouer" />
                <Button onAction="#quitGame" styleClass="btn-secondary" text="üè† Accueil" />
            </HBox>
        </VBox>
        
        <!-- CATEGORIES MANGEMENT -->
        <VBox fx:id="categoriesPane" spacing="20.0" styleClass="view-pane" visible="false">
             <HBox alignment="CENTER_LEFT" spacing="20">
                 <Button fx:id="btnCatsBack" onAction="#showHome" text="‚Üê" styleClass="btn-secondary"/>
                 <Label styleClass="title-medium" text="Gestion des cat√©gories" />
             </HBox>

             <VBox spacing="5" styleClass="card">
                 <HBox alignment="CENTER_LEFT" spacing="10">
                    <Label styleClass="label-bold" text="CAT√âGORIES ACTIVES" />
                    <Label fx:id="activeCountLabel" text="5/12" styleClass="highlight-text"/>
                 </HBox>
                 <ProgressBar fx:id="activeProgressBar" prefWidth="600.0" progress="0.4" />
             </VBox>
             
             <HBox spacing="20" styleClass="card-dark" alignment="CENTER_LEFT">
                <StackPane>
                    <Circle fill="#6c63ff" radius="25.0" />
                    <Label text="M" styleClass="label-bold" style="-fx-text-fill: white;">
                        <font><Font name="System Bold" size="24.0" /></font>
                    </Label>
                </StackPane>
                <VBox>
                    <Label text="APER√áU PARTIE" styleClass="label-bold"/>
                    <FlowPane fx:id="previewCategoriesBox" hgap="10" vgap="8"/>
                </VBox>
             </HBox>

             <HBox spacing="20.0" VBox.vgrow="ALWAYS">
                 <VBox spacing="10.0" HBox.hgrow="ALWAYS">
                     <HBox styleClass="table-header" spacing="10" alignment="CENTER_LEFT">
                         <padding>
                            <Insets top="0" right="0" bottom="0" left="10"/>
                         </padding>
                         <Label text="" prefWidth="30" /> <!-- Checkbox placeholder -->
                         <Label text="CAT√âGORIE" prefWidth="250" styleClass="header-col"/>
                         <Label text="STATUT" prefWidth="120" styleClass="header-col"/>
                         <Label text="TYPE" prefWidth="120" styleClass="header-col"/>
                         <Label text="ACTIONS" styleClass="header-col"/>
                     </HBox>
                     <ListView fx:id="categoriesList" VBox.vgrow="ALWAYS" />
                 </VBox>
                 
                 <VBox minWidth="300.0" spacing="15.0" styleClass="card">
                     <Label styleClass="label-bold" text="NOUVELLE CAT√âGORIE" />
                     <TextField fx:id="newCatNameField" promptText="Ex: Startups, Pok√©mons..." />
                     <Button onAction="#addCategory" styleClass="btn-primary" text="‚ûï AJOUTER" />
                     <Label text="2-50 caract√®res, unique" styleClass="hint-text-small"/>
                 </VBox>
             </HBox>
        </VBox>

        <!-- HISTORY SCREEN -->
        <VBox fx:id="historyPane" spacing="30.0" styleClass="view-pane" visible="false">
            <padding><Insets top="40" right="40" bottom="40" left="40" /></padding>
            
            <!-- Header -->
            <HBox alignment="CENTER_LEFT" spacing="20">
                <Button fx:id="btnHistBack" onAction="#showHome" text="‚Üê" styleClass="btn-secondary"/>
                <Label styleClass="title-medium" text="Historique des Parties" />
            </HBox>
            
            <!-- Stats Cards Row -->
            <HBox spacing="20" alignment="CENTER">
                <VBox styleClass="modern-card" spacing="10" HBox.hgrow="ALWAYS" alignment="CENTER">
                    <Label text="üéÆ" style="-fx-font-size: 32px;"/>
                    <Label text="Parties jou√©es" styleClass="label-hint-small"/>
                    <Label text="0" styleClass="title-medium" fx:id="totalGamesLabel"/>
                </VBox>
                <VBox styleClass="modern-card" spacing="10" HBox.hgrow="ALWAYS" alignment="CENTER">
                    <Label text="‚≠ê" style="-fx-font-size: 32px;"/>
                    <Label text="Meilleur score" styleClass="label-hint-small"/>
                    <Label text="0" styleClass="title-medium" fx:id="bestScoreLabel"/>
                </VBox>
                <VBox styleClass="modern-card" spacing="10" HBox.hgrow="ALWAYS" alignment="CENTER">
                    <Label text="üìä" style="-fx-font-size: 32px;"/>
                    <Label text="Score moyen" styleClass="label-hint-small"/>
                    <Label text="0" styleClass="title-medium" fx:id="avgScoreLabel"/>
                </VBox>
            </HBox>
            
            <!-- Games List -->
            <VBox spacing="15" VBox.vgrow="ALWAYS">
                <Label text="Derni√®res parties" styleClass="label-bold"/>
                <ScrollPane fitToWidth="true" VBox.vgrow="ALWAYS" styleClass="modern-scroll">
                     <content>
                          <VBox fx:id="historyList" spacing="15.0" />
                     </content>
                </ScrollPane>
            </VBox>
        </VBox>
        
        <!-- SETTINGS SCREEN -->
        <VBox fx:id="settingsPane" alignment="CENTER" spacing="20.0" styleClass="view-pane" visible="false">
             <Label fx:id="lblSettingsTitle" styleClass="title-medium" text="Configuration" />
             <VBox spacing="15.0" maxWidth="500" styleClass="card">
                 <Label styleClass="label-bold" text="Profil Joueur" />
                 <TextField fx:id="pseudoField" promptText="Pseudo" />
                 
                 <Label styleClass="label-bold" text="Apparence" />
                 <HBox spacing="10">
                     <RadioButton fx:id="themeLight" text="Clair" selected="true">
                         <toggleGroup>
                             <ToggleGroup fx:id="themeGroup"/>
                         </toggleGroup>
                     </RadioButton>
                     <RadioButton fx:id="themeDark" text="Sombre" toggleGroup="$themeGroup"/>
                 </HBox>
                 
                 <Label styleClass="label-bold" text="Langue Interface" />
                 <HBox spacing="10">
                     <RadioButton fx:id="langFr" text="Fran√ßais" selected="true">
                         <toggleGroup>
                             <ToggleGroup fx:id="langGroup"/>
                         </toggleGroup>
                     </RadioButton>
                     <RadioButton fx:id="langEn" text="English" toggleGroup="$langGroup"/>
                 </HBox>
             </VBox>
             <HBox alignment="CENTER" spacing="20">
                <Button fx:id="btnSettingsBack" onAction="#showHome" styleClass="btn-secondary" text="%btn.back" />
                <Button fx:id="btnSave" onAction="#saveSettings" styleClass="btn-primary" text="SAUVEGARDER" />
             </HBox>
        </VBox>

    </children>
</StackPane>
